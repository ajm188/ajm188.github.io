<!doctype html><html class=no-js lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<link type=text/plain rel=author href=/humans.txt>
<title>Home: Rails, Travis-CI, and Factory Girl</title>
<link rel=canonical href=https://a.ndrw.dev/posts/rails-travis-ci-and-factory-girl/>
<link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://a.ndrw.dev/css/fontawesome.min.85a136712bb18ba2ee6cd5375b6f14d9bbd245281518f2c68285053d9d0bb46d.css integrity="sha256-haE2cSuxi6LubNU3W28U2bvSRSgVGPLGgoUFPZ0LtG0="><link rel=stylesheet href=https://a.ndrw.dev/css/simplecss.min.0f03a309674cd62af1eecbaf9802cd4c6b7a1a87e842012262e6f5dccd49ed2a.css integrity="sha256-DwOjCWdM1irx7suvmALNTGt6GofoQgEiYub13M1J7So=">
<style>.time{font-style:oblique}a.fa{text-decoration:none;line-height:2}article h1 span{font-size:80%;font-weight:lighter;font-style:oblique;display:block}pre{word-wrap:normal;white-space:pre}code{font-size:.9em}pre code{color:#ddd}</style>
</head>
<body>
<div>
<header>
<nav>
<a href=https://a.ndrw.dev>Home</a>
<a href=https://a.ndrw.dev/about/>About</a>
<a href=https://a.ndrw.dev/posts/>Posts</a>
<a href=https://a.ndrw.dev/projects/>Projects</a>
&nbsp;
<a href=/posts/index.xml class="fa fa-rss" target=_blank></a>
<a class="fa fa-brands fa-github" style=height:max-content href=https://github.com/ajm188 target=_blank></a>
<a class="fa fa-brands fa-bluesky" href=https://bsky.app/profile/amason.bsky.social target=_blank></a>
</nav>
</header>
<article>
<h1>Rails, Travis-CI, and Factory Girl</h1>
<div class=time>Saturday, April 18, 2015</div>
<p>I spent the better part of tonight trying to debug getting
<a href=https://travis-ci.org/>Travis-CI</a> set up on a repository I&rsquo;m
working on, so I thought I&rsquo;d write up what the problem was, and hopefully
that may eventually help someone else not go through the same headaches.</p>
<p><a href=https://gist.github.com/ajm188/86fd587c9fc30a4d5d38>This gist</a>
was the original error I was trying to debug. See line 503 of log.txt for
the postgres error.</p>
<p>Before I begin explaining the problem, the fix is to change the Gemfile:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#6272a4># Gemfile (original)</span>
gem <span style=color:#f1fa8c>&#39;factory_girl_rails&#39;</span>

<span style=color:#6272a4># Gemfile (fix)</span>
gem <span style=color:#f1fa8c>&#39;factory_girl_rails&#39;</span>, <span style=color:#8be9fd;font-style:italic>require</span>: <span style=color:#ff79c6>false</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=the-problem>The Problem</h3>
<p>Without the <code>require: false</code>, FactoryGirl gets loaded when the
<code>rake environment</code> task is run. Without any schema loaded in the
database (which is true on every Travis run), there are no relations
defined until <code>rake db:migrate</code> completes. However,
<code>rake db:migrate</code> depends on <code>rake environment</code>.</p>
<p>This means, when we do <code>rake db:migrate</code>, FactoryGirl gets
loaded, and tries to figure out all of the factory definitions, which don&rsquo;t
exist until <code>rake db:migrate</code> completes. Whoops.</p>
<h3 id=the-fix>The Fix</h3>
<p>First, change your Gemfile to not require FactoryGirl by default, as noted
above. Then, in your rails_helper.rb, and also env.rb (for cucumber):</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#8be9fd;font-style:italic>require</span> <span style=color:#f1fa8c>&#39;factory_girl_rails&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>This delays the loading of FactoryGirl until your specs/tests/features are run,
so your database migrations can run correctly and without error on the Travis
server.</p>
</article>
</div>
<footer>
&copy; Andrew Mason 2025
&nbsp;
<a href=https://twitter.com/andrew_mason1 target=_blank>@andrew_mason1</a>
</footer>
</body>
</html>